{{/* Project card partial â€” image LEFT, text RIGHT, hard constrained image */}}

{{ $p := .Params }}

{{/* Resolve cover image */}}
{{ $cover := "" }}
{{ with $p.cover }}
  {{ if or (strings.HasPrefix . "http:") (strings.HasPrefix . "https:") }}
    {{ $cover = . }}
  {{ else }}
    {{ $res := $.Resources.GetMatch . }}
    {{ if $res }}
      {{ $cover = $res.RelPermalink }}
    {{ else }}
      {{ $cover = . | relURL }}
    {{ end }}
  {{ end }}
{{ end }}

<article class="mx-auto w-full max-w-5xl overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600 bg-white/5">

  {{/* HARD HEIGHT ROW ON DESKTOP (inline styles so it always works) */}}
  <div class="flex flex-col md:flex-row"
       style="gap:0;">

    {{/* LEFT: Image column */}}
    <div class="md:w-7/12 min-w-0 p-4 space-y-3">

      {{/* This box FORCES the image height on desktop */}}
      <a href="{{ .RelPermalink }}" class="block">
        <div
          class="w-full overflow-hidden rounded-lg bg-black/10"
          style="
            height: 260px;
          "
        >
          {{ if $cover }}
            <img
              src="{{ $cover }}"
              alt="{{ .Title }}"
              loading="lazy"
              decoding="async"
              style="
                width: 100%;
                height: 100%;
                display: block;
                object-fit: cover;
              "
            >
          {{ else }}
            <div class="w-full h-full flex items-center justify-center text-sm opacity-50">
              No image
            </div>
          {{ end }}
        </div>
      </a>

    </div>

    {{/* RIGHT: Text column (min-w-0 prevents 1-letter wrapping) */}}
    <div class="md:w-1/2 min-w-0 p-4 space-y-3">

      <div class="flex items-start justify-between gap-3">
        <h2 class="text-lg font-semibold leading-tight">
          <a href="{{ .RelPermalink }}" class="hover:underline">
            {{ .Title }}
          </a>
        </h2>

        {{ with $p.status }}
          {{ $label := . }}
          {{ if eq . "in-progress" }}{{ $label = "In Progress" }}{{ end }}
          {{ if eq . "planned" }}{{ $label = "Planned" }}{{ end }}
          {{ if eq . "complete" }}{{ $label = "Complete" }}{{ end }}
          <span class="shrink-0">
            {{ partial "badge.html" $label }}
          </span>
        {{ end }}
      </div>

      {{ with $p.summary }}
        <p class="text-sm text-neutral-600 dark:text-neutral-400">
          {{ . }}
        </p>
      {{ end }}

      {{ with $p.tags }}
        <div class="flex flex-wrap gap-2">
          {{ range . }}
            <span class="text-xs text-neutral-600 dark:text-neutral-400 border border-neutral-200 dark:border-neutral-700 rounded-md px-2 py-1">
              {{ . }}
            </span>
          {{ end }}
        </div>
      {{ end }}

      {{ with $p.links }}
        <div class="pt-1 space-y-1">
          <div class="text-xs uppercase tracking-wide text-neutral-500">Links</div>
          <ul class="text-sm list-disc list-inside">
            {{ range . }}
              <li>
                <a
                  href="{{ .url }}"
                  class="hover:underline"
                  {{ if strings.HasPrefix .url "http" }}target="_blank" rel="noopener noreferrer"{{ end }}
                >
                  {{ .name }}
                </a>
              </li>
            {{ end }}
          </ul>
        </div>
      {{ end }}

    </div>
  </div>
</article>
