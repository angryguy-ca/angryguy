{{ define "main" }}

  {{/* --------------------------------
     HERO / background (match Posts)
     -------------------------------- */}}
  {{ if site.Params.list.showHero | default false }}
    {{ $heroStyle := print "hero/" (site.Params.list.heroStyle | default "basic") ".html" }}
    {{ if templates.Exists (printf "partials/%s" $heroStyle) }}
      {{ partial $heroStyle . }}
    {{ else }}
      {{ partial "hero/basic.html" . }}
    {{ end }}
  {{ end }}

  <header class="mb-8">
    <h1 class="text-4xl font-bold">{{ .Title }}</h1>
    {{ with .Description }}
      <p class="mt-2 text-lg opacity-80">{{ . }}</p>
    {{ else }}
      {{ with .Params.description }}
        <p class="mt-2 text-lg opacity-80">{{ . }}</p>
      {{ end }}
    {{ end }}
  </header>

  {{/* All project pages */}}
  {{ $pages := where site.RegularPages "Section" "projects" }}

  {{/* Featured first (optional), then newest */}}
  {{ $featured := (where $pages ".Params.featured" true).ByDate.Reverse }}
  {{ $rest := (where $pages ".Params.featured" "!=" true).ByDate.Reverse }}
  {{ $sorted := union $featured $rest }}

  {{/* Group by status (optional) */}}
  {{ $inProgress := where $sorted ".Params.status" "in-progress" }}
  {{ $planned := where $sorted ".Params.status" "planned" }}
  {{ $complete := where $sorted ".Params.status" "complete" }}
  {{ $other := where $sorted ".Params.status" "==" nil }}

  {{/* ---------- In Progress ---------- */}}
  {{ if gt (len $inProgress) 0 }}
    <section class="mb-10">
      <div class="mb-4 flex items-center justify-between">
        <h2 class="text-xl font-semibold">In Progress</h2>
        <span class="text-sm opacity-60">{{ len $inProgress }}</span>
      </div>

      <div class="grid grid-cols-1 gap-6">
        {{ range $inProgress }}
          {{ partial "project-card.html" . }}
        {{ end }}
      </div>
    </section>
  {{ end }}

  {{/* ---------- Planned ---------- */}}
  {{ if gt (len $planned) 0 }}
    <section class="mb-10">
      <div class="mb-4 flex items-center justify-between">
        <h2 class="text-xl font-semibold">Planned</h2>
        <span class="text-sm opacity-60">{{ len $planned }}</span>
      </div>

      <div class="grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3">
        {{ range $planned }}
          {{ partial "project-card.html" . }}
        {{ end }}
      </div>
    </section>
  {{ end }}

  {{/* ---------- Complete ---------- */}}
  {{ if gt (len $complete) 0 }}
    <section class="mb-10">
      <div class="mb-4 flex items-center justify-between">
        <h2 class="text-xl font-semibold">Complete</h2>
        <span class="text-sm opacity-60">{{ len $complete }}</span>
      </div>

      <div class="grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3">
        {{ range $complete }}
          {{ partial "project-card.html" . }}
        {{ end }}
      </div>
    </section>
  {{ end }}

  {{/* ---------- Everything else ---------- */}}
  {{ if gt (len $other) 0 }}
    <section class="mb-10">
      <div class="mb-4 flex items-center justify-between">
        <h2 class="text-xl font-semibold">Projects</h2>
        <span class="text-sm opacity-60">{{ len $other }}</span>
      </div>

      <div class="grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3">
        {{ range $other }}
          {{ partial "project-card.html" . }}
        {{ end }}
      </div>
    </section>
  {{ end }}

{{ end }}